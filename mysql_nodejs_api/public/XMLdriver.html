<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Style -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="styles/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.4.1/dist/chart.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Api -->
    <title>FormulApi</title>
</head>

<body>

    <nav class="py-3 navbar navbar-expand-lg navbar-dark bg-dark shadow-sm rounded">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">FormulApi Dashboard</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Charts</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Banner -->

    <div class="px-4 pt-5 my-5 text-center border-bottom">
        <h1 class="display-4 fw-bold">Formula 1 Data Processing</h1>
        <div class="col-lg-6 mx-auto">
            <p class="lead mb-4">Responsive, mobile-first API consumer, using the chart.js package to visualise data.
                Data is
                stored and read off the MySQL server. The API is created following the requirements of module Data
                Processing.
            </p>
            <div class="d-grid gap-2 d-sm-flex justify-content-sm-center mb-5">
                <button type="button" class="btn btn-primary btn-lg px-4 me-sm-3">View CRUD Manager</button>
                <button type="button" class="btn btn-warning btn-lg px-4">View Data Visualisation</button>
            </div>
        </div>
        <div class="overflow-hidden" style="max-height: 30vh;">
            <div class="container px-5">
                <img src="https://www.formula1.com/content/dam/fom-website/manual/Misc/2021preseason/Mercedes2021Launch/f1w12_launchcar_210225_44_P4.1.jpg"
                    class="img-fluid border rounded-3 shadow-lg mb-4" alt="Example image" width="700" height="500"
                    loading="lazy">
            </div>
        </div>
    </div>

    <!-- Choices -->

    <div class="container px-4 py-5 ">
        <h2 class="display-4 fw-bold text-center">Data Sets</h2>
        <div class="row row-cols-lg-3 align-items-stretch g-4 py-5 ">
            <!-- 1st -->
            <div class="col">
                <div class="card card-cover h-100 overflow-hidden text-white bg-dark rounded-5 shadow-lg"
                    style="background-image: url('https://mir-s3-cdn-cf.behance.net/project_modules/2800_opt_1/b7e32684132123.5d53da2466f9a.jpg'); background-size: cover; border: none;">
                    <div class="d-flex flex-column h-100 p-5 pb-3 text-white text-shadow-1 card-content">
                        <h1 class="pt-5 mt-5 mb-4 display-6 lh-1 text fw-bold align-baseline">Races Data</h1>
                        <div class="row row-cols-md-2 row-cols-sm-2">


                        </div>
                    </div>
                </div>
            </div>
            <!-- 2nd  -->
            <div class="col">
                <div class="card card-cover h-100 overflow-hidden text-white bg-dark rounded-5 shadow-lg"
                    style="background-image: url('https://www.formula1.com/content/dam/fom-website/sutton/2019/Bahrain/Sunday/1017415717-LAT-20190331-_U4I2916-16x9.jpg'); background-size: cover; border: none;">

                    <div class="d-flex flex-column h-100 p-5 pb-3 text-shadow-1 card-content">
                        <h2 class="pt-5 mt-5 mb-4 display-6 lh-1 text fw-bold align-baseline">Drivers Data</h2>
                        <div class="row gap-2 mx-1 pb-3">
                            <a href='XMLdriver.html' type="button"
                                class="btn btn-outline-light me-auto col-5 h-100 py-3">XML</a>
                            <a href='/' type="button" class="btn btn-outline-light col-5 h-100 py-3">JSON</a>
                        </div>
                        <div class="row row-cols-md-2">

                        </div>
                    </div>
                </div>
            </div>
            <!-- 3rd -->
            <div class="col">
                <div class="card card-cover h-100 overflow-hidden text-white bg-dark rounded-5 shadow-lg"
                    style="background-image: url('https://mir-s3-cdn-cf.behance.net/project_modules/1400/5a686652954259.59db60c5957c5.jpg'); background-size: cover; border: none;">
                    <div class="d-flex flex-column h-100 p-5 pb-3 text-shadow-lg card-content">
                        <h2 class="pt-5 mt-5 mb-4 display-6 lh-1 fw-bold align-baseline">Tracks Data</h2>
                        <div class="row row row-cols-md-2">


                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Table Section-->
    <section name="data-section" class="data-section border">

        <div class="py-5 container px-0 mb-2 mt-1 data-table ">
            <div class="hl-1">
                <h2>Data Table</h2>
            </div>
            <!-- Data Table -->

            <div class="container">
                <div class="row">


                    <div class="col-md-12 border p-4 rounded-5" style="border-radius: 1.5rem;">
                        <h4>Datatable of all drivers</h4>
                        <div class="table-responsive ">

                            <div class="row px-2">
                                <div class="col-6">
                                    <button type="button" id="previousPage" class="btn btn-primary m-1"
                                        onclick="previousPage()">
                                        &lt; </button>
                                    <input style="width: 2rem;" disabled="true" type="text" id="currentPage">
                                    <button type="button" id="nextPage" class="btn btn-primary m-1"
                                        onclick="nextPage()">
                                        &gt; </button>
                                    <input type="search" name="search" id="searchTable">
                                </div>
                                <div class="col-sm-6">
                                    <button type="button" id="addButton" class="btn btn-primary m-1"
                                        data-bs-toggle="modal" data-bs-target="#createButton">
                                        Add Driver </button>
                                </div>


                                <!-- Modal -->
                                <div class="modal fade" id="createButton" tabindex="-1" aria-labelledby="createButton"
                                    aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel">Create a Driver</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <!-- Form -->
                                                <form id="driverCreationForm" class="row" method="post" ;>
                                                    <div class="col-md-6 mt-2"> <label for="validationDefault01"
                                                            class="form-label">First name</label> <input type="text"
                                                            class="form-control" name="forename" id="forename" value=""
                                                            placeholder=" forename " required> </div>
                                                    <div class="col-md-6 mt-2"> <label for="validationDefault02"
                                                            class="form-label">Last name</label> <input type="text"
                                                            class="form-control" name="surname" id="surname" value=""
                                                            placeholder="surname" required> </div>
                                                    <div class="col-md-6 mt-2"> <label for="validationDefault02"
                                                            class="form-label">Reference</label> <input type="text"
                                                            class="form-control" name="driverRef" id="driverRef"
                                                            value="" placeholder=" driverRef " required> </div>
                                                    <div class="col-md-6 mt-2"> <label for="validationDefault02"
                                                            class="form-label">Date Of Birth</label> <input type="text"
                                                            class="form-control" name="dob" id="dob" value=""
                                                            placeholder=" dob " required> </div>
                                                    <div class="col-md-6 mt-2"> <label for="validationDefault02"
                                                            class="form-label">Driver Nationality</label> <input
                                                            type="text" class="form-control" name="nationality"
                                                            id="nationality" value="" placeholder=" nationality"
                                                            required> </div>
                                                    <div class="modal-footer mt-5">
                                                        <button type="button" class="btn btn-secondary"
                                                            data-bs-dismiss="modal">Close</button>
                                                        <button id="create_submit" type="submit"
                                                            class="btn btn-primary">Create a Driver</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <table id="driver-table" class="table table-bordred table-striped rwd-table">

                                <thead>

                                    <th>Driver ID</th>
                                    <th>Driver Ref</th>
                                    <th>First Name</th>
                                    <th>Last Name</th>
                                    <th>DoB</th>
                                    <th>Nationality</th>

                                    <th>Edit</th>
                                    <th>Delete</th>
                                </thead>


                                <script>
                                    drawDriverTable()
                                    var items = []
                                    let currentPage = 1;
                                    document.getElementById('currentPage').value = currentPage;

                                    function getItemsPerPage() {
                                        return itemsPerPage = 20;
                                    }

                                    function getCurrentPage() {
                                        return document.getElementById('currentPage').value;
                                    }

                                    function nextPage() {
                                        let inc = getCurrentPage();
                                        const perPage = getItemsPerPage();
                                        let total = document.querySelector('tbody.new-row').querySelectorAll('tr').length;
                                        (inc < Math.abs(total / perPage)) ? document.getElementById('currentPage').value++ : -1;
                                        callPagination()
                                    }

                                    function previousPage() {
                                        let inc = getCurrentPage();
                                        (inc > 1) ? document.getElementById('currentPage').value-- : -1;
                                        callPagination()
                                    }

                                    function callPagination() {
                                        const tb = document.querySelector('tbody.new-row')
                                        const recordsPerPage = getItemsPerPage();
                                        let pageNumber = getCurrentPage();
                                        let startIndex = (pageNumber - 1) * recordsPerPage;
                                        let endIndex = pageNumber * recordsPerPage;
                                        let tableRows = tb.querySelectorAll('tr');
                                        for (let i = 0; i < tableRows.length; i++) {
                                            tableRows[i].style.display = (i > startIndex - 1 && i < endIndex) ? 'table-row' : 'none';
                                        }
                                    }


                                    function drawDriverTable() {
                                        $.get('/formula_api/drivers/XML', function (data) {
                                            let drivers = $(data).find('Driver');
                                            let items = [];

                                            drivers.each(function (index) {
                                                let driver = $(this);
                                                let driverId = driver.find('DriverId').text();
                                                let driverRef = driver.find('DriverRef').text();
                                                let forename = driver.find('forename').text();
                                                let surname = driver.find('surname').text();
                                                let dob = driver.find('dob').text();
                                                let nationality = driver.find('nationality').text();

                                                items.push("<tr><td id='" + index + "'>"
                                                    + driverId + "</td><td>"
                                                    + driverRef + "</td><td>"
                                                    + forename + "</td><td>"
                                                    + surname + "</td><td>"
                                                    + dob + "</td><td>"
                                                    + nationality + "</td><td>"
                                                    + '<button type="button" id="update" name="update" class="btn btn-warning btn-sm px-4 me-sm-3 btn btn-primary" data-bs-toggle="modal" data-bs-target="#driverEditModal' + index + '" >Update</button>'
                                                    + '<!-- Modal --> <div class="modal fade" id="driverEditModal' + index + '" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true"> <div class="modal-dialog"> '
                                                    + '<div class="modal-content"> <div class="modal-header"> <h5 class="modal-title" id="exampleModalLabel">Edit ' + surname
                                                    + '&#39;s Info</h5> <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> </div> <div class="modal-body">'
                                                    + '<!-- Form -->  <form class="row" name="driverUpdateForm" id="driverUpdateForm";>'
                                                    + '<div class="col-md-6 mt-2"> <label for="validationDefault01" class="form-label">First name</label> <input type="text" class="form-control" id="validationDefault01" value="' + forename + '" required> </div>'
                                                    + '<div class="col-md-6 mt-2"> <label for="validationDefault02" class="form-label">Last name</label> <input type="text" class="form-control" id="validationDefault02" value="' + surname + '" required> </div> '
                                                    + '<div class="col-md-6 mt-2"> <label for="validationDefault02" class="form-label">Reference</label> <input type="text" class="form-control" id="validationDefault02" value="' + driverRef + '" required> </div> '
                                                    + '<div class="col-md-6 mt-2"> <label for="validationDefault02" class="form-label">Date Of Birth</label> <input type="text" class="form-control" id="validationDefault02" value="' + dob + '" required> </div> '
                                                    + '<div class="col-md-6 mt-2"> <label for="validationDefault02" class="form-label">Driver Nationality</label> <input type="text" class="form-control" id="validationDefault02" value="' + nationality + '" required> </div> '
                                                    + '<input type="hidden" name="id" display="none" value="' + driverId + '">'
                                                    + '<div class="modal-footer mt-5"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button> <button id="update_submit" type="submit" class="btn btn-primary">Save changes</button> </form></div> </div> </div>'
                                                    + "</td><td>"
                                                    + `<button type="button" onclick="deleteDriver('${driverId}');" name="delete" class="btn btn-danger btn-sm px-4 me-sm-3">Delete</button>`
                                                    + "</td></tr>"
                                                );
                                            });

                                            let tr = $('<tbody/>');
                                            let tbody = $('#driver-table');
                                            tr.addClass('new-row');
                                            tr.html(items.join(''));
                                            tr.appendTo(tbody);
                                            callPagination();
                                        });
                                    }



                                    //Pressing the Update 
                                    $('#driverUpdateForm').on('submit', (e) => {
                                        e.preventDefault();
                                        var id = $(this).data('id');
                                        $.ajax({
                                            url: `http://localhost:4001/formula_api/drivers/update/${id}`,
                                            method: "PUT",
                                            data: $('#driverUpdateForm').serialize(),
                                            dataType: "JSON",
                                            beforeSend: function () {
                                                $('button#update_submit').attr('disabled', 'disabled')
                                            },
                                            success: function (data) {
                                                $('button#update_submit').attr('disabled', false);
                                                alert('Successful Adition, you can close the Window');
                                            },
                                            error: function (e) {
                                                console.log(e);
                                            }
                                        })
                                    })


                                    //Creating a Driver
                                    $('#driverCreationForm').on('submit', (e) => {
                                        e.preventDefault();

                                        $.ajax({
                                            url: "http://localhost:4001/formula_api/drivers/create",
                                            method: "POST",
                                            data: $('#driverCreationForm').serialize(),
                                            dataType: "JSON",
                                            beforeSend: function () {
                                                $('button#create_submit').attr('disabled', 'disabled')
                                            },
                                            success: function (data) {
                                                $('button#create_submit').attr('disabled', false);
                                                alert('Successful Adition, you can close the Window');
                                            }
                                        })
                                    })


                                    function deleteDriver(key) {
                                        let xhr = new XMLHttpRequest();
                                        xhr.open('DELETE', `/formula_api/drivers/delete/${key}`);
                                        xhr.onload = function () {
                                            location.reload();
                                        }
                                        xhr.send();
                                    }



                                </script>
                            </table>
                        </div>
                    </div>
                </div>
            </div>


            <div class="modal fade" id="edit" tabindex="-1" role="dialog" aria-labelledby="edit" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><span
                                    class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
                            <h4 class="modal-title custom_align" id="Heading">Edit Your Detail</h4>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <input class="form-control " type="text" placeholder="Mohsin">
                            </div>
                            <div class="form-group">

                                <input class="form-control " type="text" placeholder="Irshad">
                            </div>
                            <div class="form-group">
                                <textarea rows="2" class="form-control"
                                    placeholder="CB 106/107 Street # 11 Wah Cantt Islamabad Pakistan"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer ">
                            <button type="button" class="btn btn-warning btn-lg" style="width: 100%;"><span
                                    class="glyphicon glyphicon-ok-sign"></span> Update</button>
                        </div>
                    </div>
                    <!-- /.modal-content -->
                </div>
                <!-- /.modal-dialog -->
            </div>

            <!-- CHART of Natinality Popularity  -->
            <canvas id="myChart" width="400" height="400"></canvas>

            <script>

                fetch('/formula_api/drivers/XML')
                    .then(response => response.text())
                    .then(xmlData => {
                        // Create an object with nationality counts
                        const nationalityCount = {};
                        const parser = new DOMParser();
                        const xmlDoc = parser.parseFromString(xmlData, "text/xml");
                        const drivers = xmlDoc.getElementsByTagName('Driver');
                        for (let i = 0; i < drivers.length; i++) {
                            const driver = drivers[i];
                            if (!nationalityCount[driver.getElementsByTagName('nationality')[0].textContent])
                                nationalityCount[driver.getElementsByTagName('nationality')[0].textContent] = 0;
                            nationalityCount[driver.getElementsByTagName('nationality')[0].textContent]++;
                        }

                        // Extract labels and values from the nationality count object
                        const nationalityLabels = Object.keys(nationalityCount);
                        const nationalityValues = Object.values(nationalityCount);

                        const ctx = document.getElementById('myChart').getContext('2d');
                        new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: nationalityLabels,
                                datasets: [{
                                    label: 'Popularity by Nationality',
                                    backgroundColor: '#f50057',
                                    data: nationalityValues
                                }]
                            },
                            options: {
                                scales: {
                                    yAxes: [{
                                        ticks: {
                                            beginAtZero: true
                                        }
                                    }]
                                }
                            }
                        });
                    });

            </script>



            <!-- bootstrap script link -->
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
                crossorigin="anonymous"></script>
            <!-- <script src="../scripts/consumer.js"></script> -->
</body>

</html>